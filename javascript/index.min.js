document.addEventListener("DOMContentLoaded",(function(){var e=null;let t=new AWN;var n=null,o=null,a=null,l={},d=window.cy=cytoscape({wheelSensitivity:.075,zoom:1.75,boxSelectionEnabled:!0,container:document.getElementById("cy"),layout:{name:"grid",rows:2,cols:2},style:[{selector:"node[name]",style:{content:"data(name)","text-valign":"center","text-halign":"center","font-size":"8px","font-weight":"bold","border-width":1,"border-color":"#111827","text-wrap":"wrap","text-max-width":10,width:"30px",height:"30px"}},{selector:"edge",style:{width:1.5,"curve-style":"bezier","target-arrow-shape":"triangle","font-size":"10px"}},{selector:".eh-handle",style:{"background-color":"#111287",width:12,height:12,shape:"ellipse","overlay-opacity":0,"border-width":12,"border-opacity":0}},{selector:".eh-hover",style:{"background-color":"#111287"}},{selector:".eh-source",style:{"border-width":2,"border-color":"#111287"}},{selector:".eh-target",style:{"border-width":2,"border-color":"#111287"}},{selector:".eh-preview, .eh-ghost-edge",style:{"background-color":"#111287","line-color":"#111287","target-arrow-color":"#111287","source-arrow-color":"#111287"}},{selector:".eh-ghost-edge.eh-preview-active",style:{opacity:0}}],elements:{nodes:[],edges:[]}});function r(e){d.nodes().forEach((t=>{t!==e&&!0===t.data("start")&&(t.data("start",!1),t.style("border-color","black"),t.style("border-width","1"))})),e.data("start",!0),e.data("accept",!1),e.data("reject",!1),e.style("border-color","green"),e.style("border-width","3"),e.id()===a?a=null:e.id()===o&&(o=null),n=e.id()}function s(e){if(d.edges(`[source = "${e.id()}"]`).length>0)return t.info("Accept states cannot have outgoing edges. Remove any outgoing edges from this state first.",{durations:{info:3e3},labels:{info:"Oops!"}}),void(document.getElementById("accept-state").checked=!1);d.nodes().forEach((t=>{t!==e&&!0===t.data("accept")&&(t.data("accept",!1),t.style("border-color","black"),t.style("border-width","1"))})),e.data("accept",!0),e.data("start",!1),e.data("reject",!1),e.style("border-color","blue"),e.style("border-width","3"),e.id()===n?n=null:e.id()===a&&(a=null),o=e.id()}function i(e){if(d.edges(`[source = "${e.id()}"]`).length>0)return t.info("Reject states cannot have outgoing edges. Remove any outgoing edges from this state first.",{durations:{info:3e3},labels:{info:"Oops!"}}),void(document.getElementById("reject-state").checked=!1);d.nodes().forEach((t=>{t!==e&&!0===t.data("reject")&&(t.data("reject",!1),t.style("border-color","black"),t.style("border-width","1"))})),e.data("reject",!0),e.data("start",!1),e.data("accept",!1),e.style("border-color","red"),e.style("border-width","3"),e.id()===n?n=null:e.id()===o&&(o=null),a=e.id()}function c(e){e.data("start",!1),e.data("accept",!1),e.data("reject",!1),e.style("border-color","black"),e.style("border-width","1"),null!==document.getElementById("start-state")&&(document.getElementById("start-state").checked=!1),null!==document.getElementById("accept-state")&&(document.getElementById("accept-state").checked=!1),null!==document.getElementById("reject-state")&&(document.getElementById("reject-state").checked=!1),e.id()===n?n=null:e.id()===o?o=null:e.id()===a&&(a=null)}function u(e){e.remove();for(var t=e.style("label").split(","),n=0;n<t.length;n++){var o=e.source().id()+","+t[n].split("(")[1];delete l[o]}h(),console.log("transitionFunction after edge deleted",l)}function m(e){e.data("start")&&(n=null),e.data("accept")&&(o=null),e.data("reject")&&(a=null),e.remove(),h(),console.log(l)}function g(e,t=0){var n=document.getElementById("tape");n.innerHTML="";Array.from(e.entries()).sort((([e],[t])=>e-t)).forEach((([e,o])=>{const a=document.createElement("div");a.className="tape-cell",a.textContent=o,e===t&&a.classList.add("current-cell"),n.appendChild(a)}))}function h(){var e="";null!==document.getElementById("tminput")&&(e=document.getElementById("tminput").value),document.getElementById("control").innerHTML=` <p class="text-center text-lg font-bold">Control Panel</p>\n\n      \n\n      <div class="flex flex-col p-2">\n      \n        <label for="tm" class="text-center text-lg font-semibold">Tape input:</label>\n        <input type="text" name="tm" id="tminput" autocomplete="tm" value="${e}"\n          class="mt-1 p-2 w-full border-gray-300 focus:ring-blue-500 bg-gray-50 rounded-sm text-black font-bold">\n\n          <label for="speed" class="text-center text-lg font-semibold mt-2">Animation Speed:</label>\n          <select id="speed" class="mt-1 p-2 w-full border-gray-300 focus:ring-blue-500 bg-gray-50 rounded-sm text-black font-bold">\n          <option value="3500">Slower</option>\n            <option value="1000">Slow</option>\n            <option value="500">Medium</option>\n            <option value="250" selected>Fast</option>\n            <option value="150">Faster</option>\n            <option value="0">Instant</option>\n          </select>\n          \n        <button\n          class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"\n          type="button" id="runtm">Run</button>\n          <button\n          class="hidden text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"\n          type="button" id="tmhalt">Stop</button>\n      </div>\n      \n      <div id="tmStatusDiv" class=" border-[#FAF0E6] border-2 border-dashed m-2 rounded-md">\n      <p class="text-center text-lg font-semibold" id="tmStatus"></p>\n    </div>\n\n    \n\n`,document.getElementById("runtm").addEventListener("click",(function(){var e=document.getElementById("tminput").value;e.split("");if(""===e)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n      Please enter an input string.\n      </p>');if(null==n)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n        Please select a start state.\n        </p>');if(null==o)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n        Please select an accept state.\n        </p>');if(null==a)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n        Please select a reject state.\n        </p>');document.getElementById("tmStatus").innerHTML="",document.getElementById("tmStatusDiv").style.borderColor="#FAF0E6";var t=n,d=[o,a],r=l,s=document.getElementById("speed").value,i=new B(e,t,r,d,s);i.run();var c=document.getElementById("tmhalt");document.getElementById("tmhalt").classList.remove("hidden"),c.addEventListener("click",(function(){i.halt(!0),i.haltFlag=!0,g([],0),document.getElementById("tmhalt").classList.add("hidden")}))}))}function p(t){var n=t;e=n;var o=`\n<div class="p-2 m-2" id="${n.id()}">\n\n<div class="flex items-center mb-2">\n<svg class="w-6 h-6 mr-2 cursor-pointer" fill="none" id="mainControlPanel" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n</svg>\n<p class="text-lg text-center font-bold text-black">Edge panel</p>\n</div>\n\n<button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 w-full mb-2" type="button" id="addTransition" >Add Transition</button>\n\n<button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 w-full mb-2" type="button" id="deleteTransitions" >Delete Transitions</button>\n\n<button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 w-full mb-2" type="button" id="deleteEdge" >Delete Edge</button>\n\n\n\n</div>\n`;document.getElementById("control").innerHTML=o,document.getElementById("mainControlPanel").addEventListener("click",(function(){h(),d.edges().forEach((e=>{e.unselect()}))})),document.getElementById("addTransition").addEventListener("click",(function(){document.getElementById("modalTransition").classList.remove("hidden")})),document.getElementById("deleteTransitions").addEventListener("click",(function(){document.getElementById("modalTransitionDelete").classList.remove("hidden");const t=`Transitions: "${n.source().data("name")}" to "${n.target().data("name")}"`;deleteTransitionsTitle.textContent=t;var o=e.data("transitions");console.log(o);var a="";if(void 0===o||0===o.length)return document.getElementById("deleteTransitionsBody").innerHTML='<p class="text-center text-lg font-bold">No transitions to delete</p>',void document.getElementById("deleteTransitionsSubmit").classList.add("hidden");document.getElementById("deleteTransitionsSubmit").classList.remove("hidden");for(var l=0;l<o.length;l++){var d=o[l];a+=`\n<div class="transition-item">\n  <input type="checkbox" id="transition${l}" data-index="${l}">\n  <label for="transition${l}">(${d.currentSymbol}, ${d.nextSymbol}, ${d.direction})</label>\n</div>\n`}document.getElementById("deleteTransitionsBody").innerHTML=a})),document.getElementById("deleteEdge").addEventListener("click",(function(){u(n)}))}d.on("remove","edge",(function(e){for(var t=e.target,n=t.style("label").split(","),o=0;o<n.length;o++){var a=t.source().id()+","+n[o].split("(")[1];delete l[a]}console.log(l)})),d.style().selector(".highlightedEdge").style({"line-color":"red","target-arrow-color":"red"}).update(),d.style().selector(".highlightedNode").style({"background-color":"red"}),d.cxtmenu({selector:"edge",menuRadius:80,commands:[{content:'<p class="text-xs">Add transition</p>',select:function(e){d.edges().forEach((t=>{t!==e&&t.unselect()})),d.nodes().forEach((e=>{e.unselect()})),e.select(),setTimeout((()=>{document.getElementById("modalTransition").classList.remove("hidden")}),50)}},{content:'<p class="text-xs">Delete edge</p>',select:function(e){u(e)}}],fillColor:"rgba(0, 0, 0, 0.55)",activeFillColor:"rgb(17, 24, 39)",activePadding:20,indicatorSize:24,separatorWidth:3,spotlightPadding:4,adaptativeNodeSpotlightRadius:!1,minSpotlightRadius:24,maxSpotlightRadius:38,openMenuEvents:"cxttapstart taphold",itemColor:"white",itemTextShadowColor:"transparent",zIndex:9999,atMouse:!0,outsideMenuCancel:!1}),d.cxtmenu({selector:"node",menuRadius:50,commands:[{content:'<p class="text-xs">Clear State</p>',select:function(e){c(e)}},{content:'<p class="text-xs">Delete State</p>',select:function(e){m(e)}}],fillColor:"rgba(0, 0, 0, 0.55)",activeFillColor:"rgb(17, 24, 39)",activePadding:20,indicatorSize:24,separatorWidth:3,spotlightPadding:4,adaptativeNodeSpotlightRadius:!1,minSpotlightRadius:24,maxSpotlightRadius:38,openMenuEvents:"cxttapstart taphold",itemColor:"white",itemTextShadowColor:"transparent",zIndex:9999,outsideMenuCancel:!1}),d.cxtmenu({selector:"core",menuRadius:70,commands:[{content:'<p class="text-xs">State mode</p>',select:function(e){(f=!f)?(d.on("tap",b),y.textContent="Disable state mode"):(d.off("tap",b),y.textContent="Enable state mode")}},{content:'<p class="text-xs">Draw mode</p>',select:function(e){E?(E=!1,v.disableDrawMode(),document.getElementById("drawMode").textContent="Enable draw mode"):(E=!0,v.enableDrawMode(),document.getElementById("drawMode").textContent="Disable draw mode")}}],fillColor:"rgba(0, 0, 0, 0.55)",activeFillColor:"rgb(17, 24, 39)",activePadding:20,indicatorSize:24,separatorWidth:3,spotlightPadding:4,adaptativeNodeSpotlightRadius:!1,minSpotlightRadius:24,maxSpotlightRadius:38,openMenuEvents:"cxttapstart taphold",itemColor:"white",itemTextShadowColor:"transparent",zIndex:9999,outsideMenuCancel:!1}),document.getElementById("fitContent").addEventListener("click",(function(){d.fit()}));var y=document.getElementById("addState"),f=!1;function b(e){if(e.target===d){var t=function(){let e=0;for(;0!==d.$(`#q${e}`).length;)e++;return"q"+e}();d.add({group:"nodes",data:{id:t,name:t},position:{x:e.position.x,y:e.position.y}})}}y.addEventListener("click",(function(){(f=!f)?(d.on("tap",b),y.textContent="Disable state mode"):(d.off("tap",b),y.textContent="Enable state mode")}));var v=d.edgehandles({canConnect:function(e,t){if(e.data("reject")||e.data("accept"))return!1;return!(e.edgesTo(t).length>0)},edgeParams:function(e,t){return{}},preview:!0,hoverDelay:150,snap:!1,snapThreshold:10,snapFrequency:30,noEdgeEventsInDraw:!0,disableBrowserGestures:!0}),E=!1;document.getElementById("drawMode").addEventListener("click",(function(){E?(E=!1,v.disableDrawMode(),document.getElementById("drawMode").textContent="Enable draw mode"):(E=!0,v.enableDrawMode(),document.getElementById("drawMode").textContent="Disable draw mode")})),d.on("tap","node",(function(e){var t,n,o,a,l,u;t=e.target,o=(n=t).data("start"),a=n.data("accept"),l=n.data("reject"),u=`\n<div class="p-2 t" id="${n.id()}">\n<div class="flex items-center mb-2">\n<svg class="w-6 h-6 mr-2 cursor-pointer" fill="none" id="mainControlPanel" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n</svg>\n<p class="text-lg text-center font-bold text-black">State panel</p>\n</div>\n<label for="stateName" class="block text-md font-bold text-black">State:</label>\n<input type="text" id="stateName" name="stateName" class="mt-1 p-2 w-full border-gray-300 focus:ring-blue-300 bg-[white] rounded-sm text-black  font-bold" value="${n.data("name")}">\n\n<fieldset class="mt-4">\n<legend class="sr-only">State Type</legend>\n\n<div class="flex items-center mb-4">\n<input id="start-state" type="radio" name="stateType" value="start" class="w-4 h-4 m-2 border-gray-300 focus:ring-2 focus:ring-blue-300 ${o?"selected":""}" ${o?"checked":""}>\n<label for="start-state" class="block ms-2 text-sm font-medium text-black">\n  Start State\n</label>\n</div>\n\n<div class="flex items-center mb-4">\n<input id="accept-state" type="radio" name="stateType" value="accept" class="w-4 h-4 m-2 border-gray-300 focus:ring-2 focus:ring-blue-300 ${a?"selected":""}" ${a?"checked":""}>\n<label for="accept-state" class="block ms-2 text-sm font-medium text-black">\n  Accept State\n</label>\n</div>\n\n<div class="flex items-center mb-4">\n<input id="reject-state" type="radio" name="stateType" value="reject" class="w-4 h-4 m-2 border-gray-300 focus:ring-2 focus:ring-blue-300 ${l?"selected":""}" ${l?"checked":""}>\n<label for="reject-state" class="block ms-2 text-sm font-medium text-black">\n  Reject State\n</label>\n</div>\n\n</fieldset>\n\n<div class="flex justify-center">\n<button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 mb-2 w-full" type="button" id="clearState" >Clear State Type</button>\n</div>\n\n<div class="flex justify-center">\n<button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 mb-2 w-full" type="button" id="deleteStateControl" >Delete State</button>\n</div>\n\n\n</div>\n\n`,document.getElementById("control").innerHTML=u,document.getElementById("mainControlPanel").addEventListener("click",(function(){h(),d.nodes().forEach((e=>{e.unselect()}))})),document.getElementById("start-state").addEventListener("change",(function(){r(n)})),document.getElementById("accept-state").addEventListener("change",(function(){s(n)})),document.getElementById("reject-state").addEventListener("change",(function(){i(n)})),document.getElementById("stateName").addEventListener("input",(function(){n.data("name",this.value),n.style("content",this.value)})),document.getElementById("clearState").addEventListener("click",(function(){c(n)})),document.getElementById("deleteStateControl").addEventListener("click",(function(){m(n)}))})),d.on("tap","edge",(function(e){p(e.target)})),document.getElementById("deleteTransitionsSubmit").addEventListener("click",(function(){var t=document.querySelectorAll('input[type="checkbox"]');if(0!==t.length){var n=Array.from(t).filter((e=>e.checked));if(0===n.length)return document.getElementById("modal-alert-delete").classList.remove("hidden"),void(document.getElementById("modal-alert-delete").textContent="Please select at least one transition to delete");document.getElementById("modal-alert-delete").classList.add("hidden");var o=n.map((e=>parseInt(e.getAttribute("data-index")))),a=e.data("transitions");o.sort(((e,t)=>t-e)).forEach((t=>{var n=e.source().id()+","+a[t].currentSymbol;delete l[n],a.splice(t,1)})),e.data("transitions",a),console.log("transitions",a),console.log("transitionFunction",l);var d=a.map((e=>`(${e.currentSymbol}, ${e.nextSymbol}, ${e.direction})`)).join(", ");e.style("label",d),document.getElementById("modalTransitionDelete").classList.add("hidden")}else document.getElementById("deleteTransitionsSubmit").classList.add("hidden")})),document.getElementById("closeModalTransition").addEventListener("click",(function(){document.getElementById("modalTransition").classList.add("hidden"),document.getElementById("current-symbol").value="",document.getElementById("next-symbol").value="",document.getElementById("direction").value="",document.getElementById("modal-alert").classList.add("hidden")})),document.getElementById("closeModalTransitionDelete").addEventListener("click",(function(){document.getElementById("modalTransitionDelete").classList.add("hidden"),document.getElementById("modal-alert-delete").classList.add("hidden")})),document.getElementById("addTransitionSubmit").addEventListener("click",(function(){var t=document.getElementById("current-symbol").value,n=document.getElementById("next-symbol").value,o=document.getElementById("direction").value;if(""===t||""===n||""===o)return document.getElementById("modal-alert").classList.remove("hidden"),void(document.getElementById("modal-alert").textContent="Please fill in all fields");if(document.getElementById("modal-alert").classList.add("hidden"),"L"!==o&&"R"!==o)return document.getElementById("modal-alert").classList.remove("hidden"),void(document.getElementById("modal-alert").textContent="Direction must be L or R");if(r=e.source().id()+","+t,null!=l[r])return document.getElementById("modal-alert").classList.remove("hidden"),void(document.getElementById("modal-alert").textContent=`Transition already exists from state "${e.source().data("name")}" with symbol "${t}" `);e.data("transitions")||e.data("transitions",[]);var a=e.data("transitions");a.push({currentSymbol:t,nextSymbol:n,direction:o}),e.data("transitions",a);var d=a.map((e=>`(${e.currentSymbol}, ${e.nextSymbol}, ${e.direction})`)).join(", ");e.style({label:d,"text-wrap":"wrap","text-background-shape":"roundrectangle","font-size":"8px","font-family":"Arial, sans-serif","text-background-color":"#999999","text-background-opacity":.8}),document.getElementById("current-symbol").value="",document.getElementById("next-symbol").value="",document.getElementById("direction").value="";var r=e.source().id()+","+t;l[r]=[e.target().id(),n,o],console.log(l),document.getElementById("modalTransition").classList.add("hidden")}));const x=[{content:"<img src='./assets/stateModeGif.gif' alt='Tour Gif'' /><br/> Welcome to the tour guide! In order to create a state, enable state mode by clicking on the highlighted button. Then click anywhere on the canvas to create a state. For as long as state mode is enabled, you can create as many states as you want. Click next to continue the tour.",title:"State Mode",target:"#addState",order:1,group:"my-first-tour"},{content:"<img src='./assets/stateModeGif2.gif' alt='Tour Gif'' /><br/> Draw mode allows you to create transitions between states. You can enable draw mode by clicking on the highlighted button. Then click on a state and drag to another state to create a transition. You are able to create self loops by dragging from a state to itself.",title:"Draw Mode",target:"#drawMode",order:2,group:"my-first-tour"},{content:"This button allows you to fit the content of the canvas to the screen. Click next to continue the tour.",title:"Fit Content",target:"#fitContent",order:3,group:"my-first-tour"},{content:"The control panel has has different panels depending on what is selected. When a node is selected, the control panel will show the state panel. When an edge is selected, the control panel will show the edge panel. When neither a node or edge is selected, the control panel allows you to run the Turing machine on certain input. Click next to continue the tour.",title:"Control panel",target:"#control",order:4,group:"my-first-tour"},{content:"This is the canvas where you can create your Turing machine. You can zoom in and out of the canvas using the mouse wheel. You can also pan the canvas by clicking and dragging. Click next to continue the tour.",title:"Canvas",target:"#cy",order:5,group:"my-first-tour"},{content:"This is the tape where you can see how the Turing machine processes input. The tape is infinite in both directions. You can now start playing with this platform on your own. Enjoy!",title:"Tape",target:"#tape",order:6,group:"my-first-tour"}],I=new tourguide.TourGuideClient({steps:x});document.getElementById("tour").addEventListener("click",(function(){I.start()})),document.addEventListener("keydown",(function(e){if("Delete"===e.key||"Del"===e.key){var t=d.$(":selected");t.length>0&&t.forEach((e=>{e.isNode()?m(e):e.isEdge()&&u(e)}))}})),d.on("tap",(function(e){e.target===d&&(h(),console.log("Current state of transition function",l),console.log("Current state of initial state",n),console.log("Current state of accept state",o),console.log("Current state of reject state",a))})),d.on("select","edge",(function(t){p(e=t.target)})),d.on("select",(function(e){d.$(":selected").length>1&&(document.getElementById("control").innerHTML='\n        <p class="text-center text-lg font-bold">Control Panel</p>\n        <div class="flex justify-center">\n        <button class="text-white bg-[#111827] hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-[#111827] dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2" type="button" id="deleteSelected" >Delete Selected</button>\n        </div>\n        ',document.getElementById("deleteSelected").addEventListener("click",(function(){var e=d.$(":selected");e.length>0&&(e.forEach((e=>{e.isNode()?m(e):e.isEdge()&&u(e)})),h())})))}));class B{constructor(e,t,n,o,a){this.tape=new Map,e.split("").forEach(((e,t)=>this.tape.set(t,e))),this.currentIdx=0,this.currentState=t,this.transitionFunction=n,this.finalStates=o,this.delay=a,this.haltFlag=!1}async step(){var e=this.tape.get(this.currentIdx);void 0===e&&(this.tape.set(this.currentIdx,"_"),e="_");const t=`${this.currentState},${e}`;if(!(t in this.transitionFunction))return!1;{const[n,o,a]=this.transitionFunction[t];if(0!=this.delay&&await new Promise((e=>setTimeout(e,this.delay))),this.haltFlag)return;0!=this.delay&&(g(this.tape,this.currentIdx),function(e,t,n,o){var a=d.edges(`[source = "${e}"][target = "${t}"]`),l=d.nodes(`[id = "${e}"]`);a.addClass("highlightedEdge"),l.addClass("highlightedNode");const r=a.style("label"),s=a.style("text-background-color");for(var i=r.split(","),c=0;c<i.length;c+=3)i[c].includes(n)&&a.style({label:i[c]+","+i[c+1]+","+i[c+2],"text-background-color":"red"});setTimeout((()=>{a.removeClass("highlightedEdge"),l.removeClass("highlightedNode"),a.style({label:r,"text-background-color":s})}),o)}(this.currentState,n,e,this.delay)),this.tape.set(this.currentIdx,o),this.currentIdx+="R"===a?1:-1,this.currentState=n}return!0}async halt(e){document.getElementById("cy").style.pointerEvents="auto",document.getElementById("tminput").style.pointerEvents="auto",document.getElementById("runtm").style.pointerEvents="auto";const t=this.getTape(),n=this.currentState,o=d.getElementById(n).data("name");var a="";d.getElementById(n).data("accept")?(a="accept",document.getElementById("tmStatusDiv").style.borderColor="green",document.getElementById("tmStatus").innerHTML=`\n          <p class="text-center text-green-600 text-lg font-semibold break-words" id="tmStatus">\n              <span class="text-xl font-bold">Turing machine halted.</span><br>\n              Final tape: ${t}<br>\n              Final state: ${a.toUpperCase()} \n          </p>`,document.getElementById("tmhalt").classList.add("hidden")):d.getElementById(n).data("reject")?(a="reject",document.getElementById("tmStatusDiv").style.borderColor="red",document.getElementById("tmStatus").innerHTML=`\n          <p class="text-center text-red-600 text-lg font-semibold break-words" id="tmStatus">\n          <span class="text-xl font-bold">Turing machine halted.</span><br>\n          Final tape: ${t}<br>\n          Final state: ${a.toUpperCase()}\n      </p>`,document.getElementById("tmhalt").classList.add("hidden")):d.getElementById(n).data("accept")||d.getElementById(n).data("reject")||e?e&&(a="halt",document.getElementById("tmStatusDiv").style.borderColor="red",document.getElementById("tmStatus").innerHTML=`\n          <p class="text-center text-red-600 text-lg font-semibold break-words" id="tmStatus">The turing machine was manually halted.</p>\n          <p class="text-center text-red-600 text-lg font-semibold break-words" id="tmStatus">\n              Final tape: ${t}<br>\n              Final state: ${o}\n          </p>`):(a="halt",document.getElementById("tmStatusDiv").style.borderColor="red",document.getElementById("tmStatus").innerHTML=`\n        \n          <p class="text-center text-red-600 text-lg font-semibold break-words" id="tmStatus">The turing machine halted. No valid transition for state "${o}" and symbol "${this.tape[this.currentIdx]}".</p>\n          <p class="text-center text-red-600 text-lg font-semibold break-words" id="tmStatus">\n              Final tape: ${t}<br>\n              Final state: ${o}<br>\n              Status: REJECT\n          </p>`,g([],0),document.getElementById("tmhalt").classList.add("hidden"))}async run(){document.getElementById("cy").style.pointerEvents="none",document.getElementById("tminput").style.pointerEvents="none",document.getElementById("runtm").style.pointerEvents="none";for(var e=0,t=5e5;!(this.finalStates.includes(this.currentState)||this.haltFlag||++e>t);){if(!await this.step())break}!this.haltFlag&&e<=t?this.halt(!1):e>t&&!this.haltFlag&&(document.getElementById("tmStatusDiv").style.borderColor="red",document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n            The turing machine was halted because it took too long to process the input. The turing machine may be in an infinite loop. 500,000 steps were executed.\n            </p>',document.getElementById("cy").style.pointerEvents="auto",document.getElementById("tminput").style.pointerEvents="auto",document.getElementById("runtm").style.pointerEvents="auto",document.getElementById("tmhalt").classList.add("hidden"))}getTape(){const e=[];return Array.from(this.tape.keys()).sort(((e,t)=>e-t)).forEach((t=>{e.push(this.tape.get(t))})),e.join("")}}function w(){document.getElementById("overlay").style.display="none"}document.getElementById("runtm").addEventListener("click",(function(){var e=document.getElementById("tminput").value;e.split("");if(""===e)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n        Please enter an input string.\n        </p>');if(null==n)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n          Please select a start state.\n          </p>');if(null==o)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n          Please select an accept state.\n          </p>');if(null==a)return document.getElementById("tmStatusDiv").style.borderColor="red",void(document.getElementById("tmStatus").innerHTML='<p class="text-center text-red-600 text-lg font-semibold" id="tmStatus">\n          Please select a reject state.\n          </p>');document.getElementById("tmStatus").innerHTML="",document.getElementById("tmStatusDiv").style.borderColor="#FAF0E6";var t=n,d=[o,a],r=l,s=document.getElementById("speed").value,i=new B(e,t,r,d,s);i.run();var c=document.getElementById("tmhalt");document.getElementById("tmhalt").classList.remove("hidden"),c.addEventListener("click",(function(){i.halt(!0),i.haltFlag=!0,g([],0),document.getElementById("tmhalt").classList.add("hidden")}))})),document.getElementById("dropdownMenuButton").addEventListener("click",(function(){document.getElementById("dropdownMenuArea").classList.toggle("hidden")})),window.addEventListener("click",(function(e){e.target.matches("#dropdownMenuButton")||document.getElementById("dropdownMenuArea").classList.contains("hidden")||document.getElementById("dropdownMenuArea").classList.add("hidden")})),document.getElementById("exportAsPng").addEventListener("click",(function(){if(0!==d.elements().length){var e=d.jpeg(),n=document.createElement("a");n.href=e,n.download="turing-machine.png",n.click(),t.info("PNG exported successfully!",{durations:{info:2e3},labels:{info:"Exported"}})}else t.info("The canvas is empty. Please create a Turing machine before exporting.",{durations:{info:3e3},labels:{info:"Empty Canvas"}})})),document.getElementById("exportAsJson").addEventListener("click",(function(){if(0===d.elements().length)return void t.info("The canvas is empty. Please create a Turing machine before exporting.",{durations:{info:3e3},labels:{info:"Empty Canvas"}});!function(e){e.elements().forEach((e=>{e.data("style",e.style())}))}(d);const e={identifier:"tmSimulatorDelanoMartin",elements:d.elements().jsons(),transitionFunction:l,startState:n,acceptState:o,rejectState:a};var r=document.createElement("a");r.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),r.download="turing-machine.json",r.click(),t.info("JSON exported successfully",{durations:{info:2e3},labels:{info:"Exported"}})})),document.getElementById("importJson").addEventListener("click",(function(){document.getElementById("importJsonBtn").click()})),document.getElementById("importJsonBtn").addEventListener("change",(async function(e){document.getElementById("overlay").style.display="flex";const c=e.target,u=c.files[0];if(!u)return void w();if("application/json"!==u.type)return t.info("The selected file is not a JSON file. Please select a valid JSON file.",{durations:{info:5e3},labels:{info:"Invalid File Type"}}),void w();const m=new FileReader;m.onload=async function(e){try{const c=JSON.parse(e.target.result);if("tmSimulatorDelanoMartin"!==c.identifier)return t.info("The imported JSON file is not recognized. Please make sure you are using a file exported from our platform that contains the necessary Turing machine data.",{durations:{info:5e3},labels:{info:"Invalid File"}}),void w();if(0===c.elements.length)return t.info("The imported JSON file does not contain any Turing machine data. Please make sure you are using a file exported from our platform that contains the necessary Turing machine data.",{durations:{info:5e3},labels:{info:"Empty File"}}),void w();n=c.startState,o=c.acceptState,a=c.rejectState,d.elements().length>0&&await d.elements().remove(),l=c.transitionFunction,await d.json(c),d.edges().forEach((e=>{var t=e.source().id();e.target().id();if(e.data("transitions")){var n=e.data("transitions").map((e=>{var n=t+","+e.currentSymbol,o=l[n];return{currentSymbol:e.currentSymbol,nextSymbol:o[1],direction:o[2]}}));e.data("transitions",n);var o=n.map((e=>`(${e.currentSymbol}, ${e.nextSymbol}, ${e.direction})`)).join(", ");e.style({label:o,"text-wrap":"wrap","text-background-shape":"roundrectangle","font-size":"8px","font-family":"Arial, sans-serif","text-background-color":"#999999","text-background-opacity":.8})}})),null!=n&&r(d.$("#"+n)),null!=o&&s(d.$("#"+o)),null!=a&&i(d.$("#"+a)),t.info("Turing machine imported successfully",{durations:{success:2e3},labels:{info:"Imported"}})}catch(e){t.info("An error occurred while importing the JSON file. Please make sure the file is in the correct format.",{durations:{info:5e3},labels:{info:"Import Error"}})}finally{await d.fit(),w()}},m.readAsText(u),c.value=null})),document.getElementById("navbarToggle").addEventListener("click",(function(){document.getElementById("navbarMobile").classList.toggle("hidden")}))}));